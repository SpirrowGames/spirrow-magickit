{% extends "base.html" %}

{% block title %}Projects - Magickit{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Projects</h1>
    <p class="subtitle">Manage your projects and workspaces</p>
</div>

<!-- Workspace Selector -->
<div class="toolbar">
    <select id="workspace-select" class="select"
            hx-get="/dashboard/projects"
            hx-target="#projects-list"
            hx-include="[name='workspace_id']"
            name="workspace_id">
        {% for workspace in workspaces %}
        <option value="{{ workspace.id }}"
                {% if workspace.id == selected_workspace %}selected{% endif %}>
            {{ workspace.name }}
        </option>
        {% endfor %}
    </select>

    <button class="btn btn-primary"
            onclick="showModal('create-project-modal')">
        New Project
    </button>
</div>

<!-- Projects List -->
<div id="projects-list" class="projects-grid"
     hx-get="/dashboard/projects?workspace_id={{ selected_workspace }}"
     hx-trigger="load"
     hx-swap="innerHTML">
    <p class="loading">Loading projects...</p>
</div>

<!-- Create Project Modal -->
<div id="create-project-modal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create Project</h3>
            <button class="close-btn" onclick="hideModal('create-project-modal')">&times;</button>
        </div>
        <form hx-post="/dashboard/projects"
              hx-target="#projects-list"
              hx-swap="innerHTML"
              hx-on::after-request="hideModal('create-project-modal')">
            <input type="hidden" name="workspace_id" id="new-project-workspace">

            <div class="form-group">
                <label for="project-name">Name</label>
                <input type="text" id="project-name" name="name" required
                       placeholder="My Project">
            </div>

            <div class="form-group">
                <label for="project-description">Description</label>
                <textarea id="project-description" name="description"
                          placeholder="Project description..."></textarea>
            </div>

            <div class="form-actions">
                <button type="button" class="btn" onclick="hideModal('create-project-modal')">
                    Cancel
                </button>
                <button type="submit" class="btn btn-primary">
                    Create
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('workspace-select').addEventListener('change', function() {
    document.getElementById('new-project-workspace').value = this.value;
});
// Initialize
document.getElementById('new-project-workspace').value =
    document.getElementById('workspace-select').value;
</script>
{% endblock %}
